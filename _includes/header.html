
<!-- All the meta tags in the world -->

<meta property="og:image" content="http://robertheaton.com/images/icon.png"/>
<meta property="og:image:width" content="300" />
<meta property="og:image:height" content="300" />
<meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type' />
{% if page.date %}
<meta content='{{ site.url }}{{ page.url }}' property='og:url' />
<meta property="og:type" content="article"/>
<meta property="og:title" content="{{ page.title }} | {{ site.name }}"/>
<meta property="og:description" content="{{ page.content | strip_html | strip_newlines | truncate: 200 }}"/>
{% else %}
<meta content='{{ site.url }}' property='og:url' />
<meta property="og:type" content="blog"/>
<meta property="og:title" content="{{ site.name }}"/>
<meta property="og:description" content="{{ site.description }}"/>
{% endif %}
<!-- All the meta tags in the world -->

<link href='/stylesheets/reset.css' rel='stylesheet' type='text/css' />
<link href='/stylesheets/codemirror.css' rel='stylesheet' type='text/css' />
<link href='/stylesheets/style.css' rel='stylesheet' type='text/css' />
<link href='/stylesheets/font-awesome.min.css' rel='stylesheet' type='text/css' />
<link href='http://fonts.googleapis.com/css?family=Merriweather:400,300' rel='stylesheet' type='text/css' />
<link rel="shortcut icon" href="images/fav.png"/>
<script src='/javascripts/jquery.js' type='text/javascript'></script>
<script src='/javascripts/codemirror.js' type='text/javascript'></script>
<script src='/javascripts/javascript-cm.js' type='text/javascript'></script>
<script src='/javascripts/ruby-cm.js' type='text/javascript'></script>
<script src='/javascripts/html-cm.js' type='text/javascript'></script>
<script src='/javascripts/shell-cm.js' type='text/javascript'></script>
<script src='/javascripts/pd.js' type='text/javascript'></script>
<script src='/javascripts/stuff.js' type='text/javascript'></script>
<script type='text/javascript'>
 // ----------------------------
var timingInterval = 10;
var activeReadingTime = 0;
var dormancyThreshold = 90;
var docLoadTimestamp = getTimeInSeconds();
updateLastActionTime();
window.setInterval(function(){
  // determine whether scroll suggests document is dormant
  if (window.isActive && (getTimeInSeconds() - window.lastActionTime) > dormancyThreshold) {
    setStatusToInactive();
    var dormancyTime = getTimeInSeconds() - docLoadTimestamp;
    _gaq.push(['_trackEvent','Document became dormant', dormancyTime + ' seconds', pageTitle, dormancyTime, true]);
    console.log('Recorded dormancy after '+ dormancyTime + ' seconds')
  }

  if (window.isActive) {
    activeReadingTime += timingInterval;
    nonInteraction = activeReadingTime < 30 ? true : false
    
    var pageTitle = "{{ post.title }}" || "Home"
    _gaq.push(['_trackEvent','Reading time', activeReadingTime + ' seconds', pageTitle, $(window).scrollTop(), nonInteraction]);
    console.log('Tracked reading time of ' + activeReadingTime + ' seconds');
  }

}, timingInterval * 1000)
// ----------------------------
// bind listeners
$(window).bind('focus', handleFocus);
$(window).bind('blur', handleBlur);
$(document).bind('mouseover', logAction);
$(document).bind('scroll', logAction);


// Setup a function to make sure we only time active page engagement
window.isActive = false;
function getTimeInSeconds(){
  return Math.round( (new Date()).getTime() / 1000 );
}
function updateLastActionTime(){
  window.lastActionTime = getTimeInSeconds();
  console.log('last action time updated to: ' + window.lastActionTime)
}
function handleFocus(){
  console.log('Window focussed');
  logAction();
}
function handleBlur() {
  setStatusToInactive();
  console.log('Window blurred');
};
function setStatusToInactive(){
  window.isActive = false;
  console.log('Window has become inactive')
}
function logAction(){
  updateLastActionTime();
  window.isActive = true;
};
// ---------------------------
</script>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=363054883773990";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
{% include ga.html %}